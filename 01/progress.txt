Basic logic of the program